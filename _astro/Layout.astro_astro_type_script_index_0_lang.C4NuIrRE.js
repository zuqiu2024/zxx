import{_ as B}from"./preload-helper.BlTxHScW.js";import{p as S,u as A}from"./url-utils.BYYtzi61.js";import{k as E,l as v,m as L,B as C,n as g,o as k}from"./setting-utils.Bg7Chrdw.js";import{s as M}from"./navBarConfig.Bx7Aaq8G.js";import"./zh_TW.Bl-Ke2VL.js";function w(){function e(t){if(t.hasAttribute("data-icon-initialized"))return;t.setAttribute("data-icon-initialized","true");const n=t.querySelector("[data-loading-indicator]"),o=t.querySelector("[data-icon-element]"),i=o?.getAttribute("icon");if(!n||!o)return;function s(){return o.shadowRoot&&o.shadowRoot.children.length>0?(a(),!0):!1}function a(){n.style.display="none",o.classList.remove("opacity-0"),o.classList.add("opacity-100")}function r(){n.style.display="inline-flex",o.classList.remove("opacity-100"),o.classList.add("opacity-0")}if(r(),o.addEventListener("load",()=>{a()}),o.addEventListener("error",()=>{i&&console.warn(`Failed to load icon: ${i}`)}),window.MutationObserver){const d=new MutationObserver(()=>{s()&&d.disconnect()});d.observe(o,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{d.disconnect(),s()},5e3)}setTimeout(()=>{s()},100)}document.querySelectorAll("[data-icon-container]").forEach(e),window.MutationObserver&&new MutationObserver(n=>{n.forEach(o=>{o.addedNodes.forEach(i=>{if(i.nodeType===Node.ELEMENT_NODE){const s=i;s.hasAttribute?.("data-icon-container")?e(s):s.querySelectorAll("[data-icon-container]").forEach(e)}})})}).observe(document.body,{childList:!0,subtree:!0})}const x=Object.freeze(Object.defineProperty({__proto__:null,initIconLoader:w},Symbol.toStringTag,{value:"Module"})),b=!!document.getElementById("banner-wrapper");function l(e,t){document.addEventListener("click",n=>{let o=document.getElementById(e);if(!o)return;let i=n.target;if(i instanceof Node){for(let s of t){let a=document.getElementById(s);if(a==i||a?.contains(i))return}o.classList.add("float-panel-closed")}})}l("display-setting",["display-setting","display-settings-switch"]);l("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]);l("search-panel",["search-panel","search-bar","search-switch"]);l("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]);l("theme-mode-panel",["theme-mode-panel","scheme-switch"]);function y(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(t=>{if(!t.parentNode)return;const n=document.createElement("div");n.className="katex-display-container",t.parentNode.insertBefore(n,t),n.appendChild(t),n.style.cssText=`
			overflow-x: auto;
		`,t.setAttribute("data-scrollbar-initialized","true")})}function I(){requestAnimationFrame(()=>{const e=document.getElementById("banner");e&&e.classList.remove("opacity-0","scale-105");const t=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');t&&(t.classList.remove("opacity-0","scale-105"),t.classList.add("opacity-100"))})}const T=()=>{window.swup.hooks.on("link:click",()=>{if(document.documentElement.style.setProperty("--content-delay","0ms"),document.documentElement.classList.add("is-page-transitioning"),b){const e=document.getElementById("navbar-wrapper");if(e&&document.body.classList.contains("lg:is-home")){const t=window.innerHeight*(g/100)-88;document.documentElement.scrollTop>=t&&e.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{const e=document.getElementById("grid-class-carrier");if(e){const i=e.getAttribute("data-grid-class"),s=document.getElementById("main-grid");if(s&&i){const r=s.className.split(" ").filter(c=>!c.startsWith("lg:grid-cols-")&&!c.startsWith("md:grid-cols-")&&!c.startsWith("grid-cols-")),d=i.split(" ");s.className=[...r,...d].join(" ")}}if(y(),B(async()=>{const{initIconLoader:i}=await Promise.resolve().then(()=>x);return{initIconLoader:i}},void 0).then(({initIconLoader:i})=>{i()}),document.getElementById("toc-wrapper")!==null){const i=document.querySelector("table-of-contents");i&&typeof i.init=="function"&&setTimeout(()=>{i.init()},100)}const o=document.getElementById("navbar");o&&o.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection()}),window.swup.hooks.on("visit:start",e=>{const t=document.querySelector("body"),n=S(e.to.url,A("/"));n?t.classList.add("lg:is-home"):t.classList.remove("lg:is-home");const o=document.querySelector(".banner-text-overlay");o&&(n?o.classList.remove("hidden"):o.classList.add("hidden"));const i=document.getElementById("navbar");i&&(i.setAttribute("data-is-home",n.toString()),i.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection());const s=window.innerWidth<1024;if(s){const m=document.getElementById("post-list-container");m&&(m.style.transition="none")}const a=document.getElementById("banner-wrapper"),r=document.querySelector(".absolute.w-full.z-30");s&&a&&r?n?(r.style.transition="none",a.style.display="",setTimeout(()=>{a.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{r.classList.remove("mobile-main-no-banner"),setTimeout(()=>{r.style.transition=""},50)},150)):(a.classList.add("mobile-hide-banner"),setTimeout(()=>{r.classList.add("mobile-main-no-banner")},100)):!s&&a&&(a.style.display="",a.classList.remove("mobile-hide-banner"),r&&r.classList.remove("mobile-main-no-banner"));const d=document.getElementById("page-height-extend");d&&d.classList.remove("hidden");let c=document.getElementById("toc-wrapper");c&&c.classList.add("toc-not-ready")}),window.swup.hooks.on("page:view",()=>{const e=document.getElementById("page-height-extend");e&&e.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),window.innerWidth<1024&&setTimeout(()=>{const a=document.getElementById("post-list-container");a&&(a.style.transition="")},600);const n=localStorage.getItem("theme")||M.themeColor.defaultMode||"light";let o=!1;n==="system"?o=window.matchMedia("(prefers-color-scheme: dark)").matches:o=n==="dark";const i=o?L.darkTheme:L.lightTheme;document.documentElement.getAttribute("data-theme")!==i&&document.documentElement.setAttribute("data-theme",i),setTimeout(()=>{if(document.getElementById("tcomment")){const a=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(a),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",e=>{setTimeout(()=>{const t=document.getElementById("page-height-extend");t&&t.classList.add("hidden");const n=document.getElementById("toc-wrapper");n&&n.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)})};window?.swup?.hooks?T():document.addEventListener("swup:enable",T);let u=document.getElementById("back-to-top-btn"),p=document.getElementById("toc-wrapper"),h=document.getElementById("navbar-wrapper");function _(){const e=document.documentElement.scrollTop,t=window.innerHeight*(g/100),n=[];u&&n.push(()=>{e>t?u.classList.remove("hide"):u.classList.add("hide")}),b&&p&&n.push(()=>{e>t?p.classList.remove("toc-hide"):p.classList.add("toc-hide")}),b&&h&&n.push(()=>{const i=document.body.classList.contains("lg:is-home")&&window.innerWidth>=1024?k:g,s=window.innerHeight*(i/100)-88;e>=s?h.classList.add("navbar-hidden"):h.classList.remove("navbar-hidden")}),n.length>0&&requestAnimationFrame(()=>{n.forEach(o=>o())})}let f;window.addEventListener("scroll",()=>{f&&cancelAnimationFrame(f),f=requestAnimationFrame(_)},{passive:!0});window.onresize=()=>{let e=Math.floor(window.innerHeight*(C/100));e=e-e%4,document.documentElement.style.setProperty("--banner-height-extend",`${e}px`)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{I(),y()}):(I(),y());document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{E(),v(),w()}):(E(),v(),w());
